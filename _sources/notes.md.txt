# Notes

## Noise Model

Every voxel of a Nuclear Magnetic Resonance image has a measured magnitude M,
composed by the true signal A and the noise. The noise results from the
composition of gaussian noise with zero mean both on the 
real and complex components of NMR signal.

The noise assumes a Rayleigh distribution in the magnitude image,
which is characteristic of MRI and other coherent imaging systems where
complex or bivariate data is converted to magnitude by quadrature sum. 
The Rayleigh distribution parameter sigma_r is estimated from background as:
$$
    sigma_r = std(bg_area) / 0.655
$$
where 0.655 ≈ sqrt(2/π) relates the Rayleigh distribution's standard
deviation to its scale parameter (sigma).

By estimation of noise level it is possible to subtract it and so to better
approximate A, the true value of signal.

The relationship between true signal A and the measured 
magnitude average and standard deviation follows the equation:
$$    
     A^2 = m_ave^2 + m_sd^2 - 2 * sigma_r^2
$$
and for A=0 (i.e. in the background) it results:
    
   m_ave_bg = 1.253*sigma_r   and   m_sd_bg = 0,655*sigma_r

Reference:
R. Mark Henkelman, "Measument of signal intensities in the presence of 
noise in MR images", published in 1985.


## Cleaning Algorithm Steps

1. Validate inputs (non-zero or negative images, valid background statistics)
2. Compute image local statistics: mean (m_ave) and std (m_sd)
    (already squared for computation convenience)
3. Estimate Rayleigh noise parameter from background: sigma_r
4. Calculate corrected magnitude squared:$$ A² = m_ave² + m_sd² - 2*sigma_r² $$
5. Apply positivity constraint: A²[A² < 0] = 0
6. Return corrected magnitude: A = sqrt(A²)


## Assumptions

- Images and background are positive valued
- Noise follows a Rayleigh distribution 
- Background region contains only noise (negligible true signal)


## Limitations

- Assumes spatially uniform noise characteristics
- The filter size affects the fine details and edges of the images
