# mri-noiselab

A python library that estimates and reduces noise in magnetic resonance images.

mri-noiselab is a Python library aimed to reduce noise in magnetic resonance (MRI)
magnitude images by estimating Rayleigh-distributed noise from a background region,
with support for masked data. 
Useful in image preprocessing for quantitative MRI studies.
The core algorithm relies on the relationship among true signal A, the measured 
magnitude average  `m_ave` and standard deviation `m_sd` and the noise distribution 
`sigma_r` parameter, following this equation:
   
    A = m_ave^2 + m_sd^2 - 2 * sigma_r^2

See the {doc}`notes` page for full scientific explanations.

## Installation

#### From source

Clone the repository and install it.
```bash
    git clone https://github.com/serebede/mri-noiselab.git
    cd mri-noiselab
    pip install .
```
or directly 
```bash
    pip install git+https://github.com/serebede/mri-noiselab.git
```
then inside you python code import the module
 (pay attention to the underscore)

```python
    import mri_noiselab
```
Make sure the required dependencies are installed (see below).

## Dependencies

 - numpy 2.4.1
 - scipy 1.17

If not present, pip will automatically try to install them or upgrade them.


### Basic Usage

Inputs must contain finite, non-negative valued, numpy array.
Background regions must contain noise only (i.e. no signal).

```python
import pydicom
import numpy as np
from mri_noiselab import subtract_noise

# Read the dicom file
ds = pydicom.dcmread("example_mri.dcm")
# Convert it into a numpy array
image = ds.pixel_array.astype(np.float32)

# Select a background region (noise only)
background = image[0:50, 0:50]

corrected = subtract_noise(image, background)
```
See {doc}`subtract_noise<api/subtract-noise>` for detailed behaviour.


### Masked Array Support

The library supports NumPy masked arrays via dedicated wrapper 
`subtract_noise_masked`

```python
import numpy as np
from mri_noiselab import subtract_noise_masked

ds = pydicom.dcmread("example_mri.dcm")
image = ds.pixel_array.astype(np.float32)

threshold = 10

image_ma = np.ma.masked_array(image, mask = image >= threshold)
bg_ma = np.ma.masked_array(background, mask = background < threshold)

cleaned_ma = subtract_noise_masked(image_ma, bg_ma)
```

By default masked pixels are excluded from validation and restored in the output.
See {doc}`api reference<api/subtract-noise-masked>` for detailed behaviour.


## Documentation

Online full documentation is here provided at the following website sections

```{toctree}
:maxdepth: 2

notes

api/api-index

tutorial/tut-index

howto/how-index

```


## Author
Serena Bedeschi
e-mail: serena.bedeschi@studio.unibo.it
GitHub: SereBede


## License
This project is licensed under the Creative Commons
Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)
for educational and research purposes. 

Free access to the source code at GitHub repository
[GitHub repository](https://github.com/serebede/mri-noiselab.git)

Commercial use is not permitted without explicit permission
from the author.


## Contributing

Suggestions, bug reports, and improvements are welcome.

If you want to contribute developing the module:
1. Fork the repository
2. Create a feature branch
3. Add tests where appropriate
4. Submit a pull request with a clear description

Please ensure that the code follows the existing style
and that tests pass before submitting.


